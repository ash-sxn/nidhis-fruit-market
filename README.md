# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/23bf365f-078f-410f-a3a6-f10604944855

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/23bf365f-078f-410f-a3a6-f10604944855) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

```sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
```

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/23bf365f-078f-410f-a3a6-f10604944855) and click on Share -> Publish.

## Razorpay configuration

To accept payments in production, configure the following environment variables for both the frontend deployment (Vercel) and the Supabase Edge functions:

- `RAZORPAY_KEY_ID` – your public key, exposed to the browser when creating the checkout session.
- `RAZORPAY_KEY_SECRET` – your private key, used server-side when creating Razorpay orders.
- `RAZORPAY_WEBHOOK_SECRET` – shared secret for verifying Razorpay webhooks.

Remember to update the webhook URL inside the Razorpay dashboard to point to `/api/razorpay/webhook` of your deployed site so that order statuses are synchronised once a payment is captured.

### Managing secrets in each environment

- **Local development** – create a `.env.local` file (ignored by git) with the three variables so `npm run dev` and the API routes can read them. Example:
  ```ini
  RAZORPAY_KEY_ID=rzp_test_...
  RAZORPAY_KEY_SECRET=...
  RAZORPAY_WEBHOOK_SECRET=...
  ```
  Share these only with trusted teammates and rotate them if they leak.
- **Production deploys (Lovable/Vercel)** – open the project settings and add the same variables under *Environment Variables*. Both Lovable and Vercel inject them at runtime so they never live in your git history. Update them in every environment you deploy (Preview, Staging, Production) so the API route can create Razorpay orders everywhere.
- **GitHub** – if you run CI/CD from GitHub Actions, store the variables as *Repository secrets* (e.g., `RAZORPAY_KEY_ID`, `RAZORPAY_KEY_SECRET`, `RAZORPAY_WEBHOOK_SECRET`) and reference them in your workflow files. This keeps automated deploy scripts from hard-coding sensitive values. Limit access to collaborators who truly need it.
- **Supabase Edge Functions** – mirror the same variables in the Supabase dashboard under *Project Settings → API → Config Variables* so webhook verification and any background jobs can read them.

Never commit `.env` files or paste keys directly into source. If a secret changes, rotate it in every location (dashboard, hosting, CI) and redeploy so the new value propagates.

### Choosing a webhook secret

- The webhook secret is **not** generated by Razorpay. You choose it, store it in your deployment environment as `RAZORPAY_WEBHOOK_SECRET`, and paste the exact same value into the Razorpay Dashboard when you create the webhook. Razorpay includes an HMAC signature of every webhook payload using this shared secret, and the handler at `api/razorpay/webhook.ts` recomputes the signature to confirm the request really came from Razorpay.
- Pick a long, random string—32 bytes or more—and treat it like a password. A common approach is to generate hex using `openssl rand -hex 32` or base64 using `node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"`. Password managers and secret vaults can also create and store these tokens.
- Avoid short or human-generated strings. Razorpay’s signature is only as strong as the secret you pick; using a high-entropy random value prevents attackers from guessing it and spoofing webhook calls.

### What the new Razorpay helpers do

- `src/lib/razorpay.ts` lazily injects Razorpay’s hosted checkout script the first time a shopper starts the payment flow. This keeps the initial bundle light while still letting the checkout page call `ensureRazorpay()` and construct the modal on demand.
- `src/vite-env.d.ts` declares the minimal TypeScript interfaces for the global `window.Razorpay` constructor so our React components remain type-safe even though the SDK is loaded from Razorpay’s CDN instead of npm.
- `api/razorpay/create-order.ts` is the serverless function that signs Razorpay REST requests with `RAZORPAY_KEY_ID`/`RAZORPAY_KEY_SECRET` and returns an order ID for the browser checkout widget. Without these credentials the modal cannot be opened.

### Verifying your webhook form in the Razorpay dashboard

- **Webhook URL** should match the public origin of your deployment with `/api/razorpay/webhook` appended. For example, if your site is served from `https://nidhisfruits.ddns.net`, the screenshot’s URL of `https://nidhisfruits.ddns.net/api/razorpay/webhook` is correct.
- **Secret** must exactly match the `RAZORPAY_WEBHOOK_SECRET` stored in your hosting environment so the handler can validate signatures.
- **Alert Email** is optional; Razorpay uses it to notify you if deliveries fail.
- **Active Events** control which webhook payloads Razorpay sends. To mirror the behaviour of the checkout flow in this repo, enable:
  - `payment.authorized` and `payment.captured` so you can confirm that the payment succeeded.
  - `payment.failed` to mark orders as cancelled if a payment is declined.
  - `order.paid` if you want a redundant notification once Razorpay settles the order.
  You can leave the dispute events disabled unless you plan to automate dispute handling; they generate emails anyway and can be enabled later without redeploying code.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)
